Unit]
Description=Install Scalock Gateway
After=docker.service bootstrap.service
Requires=docker.service


[Service]
User=core
TimeoutStartSec=0
Environment="dbpassword=etcdctl get /scalock/config/db-password"
Environment="dbusername=etcdctl get /flight-director/config/db-username"
Environment="scalockdbname=etcdctl get /aqua/config/db-name"
Environment="scalockdb_endpoint=etcdctl get /aqua/config/db-path"
Environment="scalock_audit_dbname=etcdctl get /aqua-audit/config/db-name"
Environment="scalock_audit_db_endpoint=etcdctl get /aqua-audit/config/db-path"

ExecStartPre=/usr/bin/sh -c "source /etc/profile.d/etcdctl.sh"


ExecStart=/usr/bin/sh -c "source /etc/profile.d/etcdctl.sh && \
  sudo docker run --rm -ti \
  -e SCALOCK_SERVER=<GATEWAY ADDRESS> \
  -e SCALOCK_TOKEN=<TOKEN> \
  -e SILENT=yes \
  -v /var/run/docker.sock:/var/run/docker.sock \
  scalock/scalock-agent:stable

[X-Fleet]
Global=true
